# **README: Evolutionary Optimization for Rigid-Body Locomotion**  

## **Overview**  
This project implements an **evolutionary optimization algorithm** to evolve rigid-body robot designs that can effectively "learn to walk" using **DiffTaichi**. The optimization process tunes **spring actuation and stiffness** to minimize a loss function, promoting movement in a desired trajectory.  

The system explores different symmetrical robot skeletons (e.g., triangles, squares, hexagons) and optimizes their locomotion using **gradient-based learning**. Evolutionary strategies, including **crossover and mutation**, refine the population over multiple generations to find the best-performing robot design.  

---

## **How It Works**  

### **1. Individual Evaluation (`evaluate_individual`)**  
Each robot is optimized using `rigid_body.py`, which trains it over a specified number of iterations. The final loss value is recorded to determine its performance.  

### **2. Evolutionary Process (`parallel_evolutionary_optimize`)**  
- **Initialization**: A random population of rigid-body designs is generated.  
- **Evaluation**: Each design is tested in parallel using multiprocessing.  
- **Selection**: The best-performing designs are chosen based on their loss values.  
- **Crossover & Mutation**: New designs are generated by combining features from selected parents, with a small chance of mutation.  
- **Repeat**: The process continues for a set number of generations, improving locomotion performance.  

### **3. Data Saving & Visualization**  
- **Results are saved** after each generation, storing the population and loss values.  
- **Plots of loss progression** and **population distribution** help analyze the learning process.  

---

## **Usage Instructions**  

### **Running the Optimization**  
To execute the evolutionary optimization process, use:  

```bash
python3 main_opt.py [run=para] [shape=wheel/circle] [iter=1, 2, ..., n] [path=cos/sin/parabola] [generations=1, 2, ..., n] [population_size=1, 2, ..., n]
```

#### **Arguments:**  
- `run` → `"para"` for parallel execution  
- `shape` → `"wheel"` or `"circle"` (determines body structure)  
- `iter` → Number of iterations per individual (e.g., `20`)  
- `path` → `"cos"`, `"sin"`, or `"parabola"` (desired movement trajectory)  
- `generations` → Number of generations to evolve  
- `population_size` → Number of individuals in each generation  

#### **Example Command:**
```bash
python3 main_opt.py para wheel 20 sin 10 10
```
This runs **10 generations** of **10 robots per generation**, optimizing their ability to follow a **sine wave trajectory** using **parallel processing**.

---

## **Key Files & Functions**  

| File               | Description |
|--------------------|-------------|
| `rigid_body.py`   | Runs physics-based optimization of a single robot. |
| `main_opt.py`     | Manages evolutionary optimization and population-based learning. |
| `evaluate_individual(n_boxes)` | Runs optimization for a single robot shape. |
| `parallel_evolutionary_optimize()` | Performs genetic algorithm with selection, crossover, and mutation. |
| `save_generation_losses(all_generation_losses)` | Saves loss data for later analysis. |
| `plot_generation_losses(all_generation_losses, all_populations)` | Generates graphs showing optimization trends. |
| `plot_population_distribution_and_avg_loss(all_generation_losses, all_populations)` | Visualizes population evolution and loss changes. |

---

## ** Further Customization**  
In `main_opt.py`:
- `mutation_rate` | Rate of mutation during evolutionary optimization process.
- `visualize` | If True, shows the plotted figures on screen. Default is False.
- `save_results` | If True, saves figures and generation losses to directory (default is "results"). Default is True.

In rigid_body.py:
- `gen_abs_sine_path()`, `gen_sine_path()`, `gen_parabola_path()`, `gen_cos_path()` | Values like `amplitude` and `frequency` can be changed to alter shape of path.
- `dist_w`, `dev_w', 'def_w' | Loss function weights for various metrics.

In robot_config.py:
- `build_robot_skeleton()` | Function that generates robot skeletons. Various parameters can be changed (e.g. size, spring_length, etc).
 

---
